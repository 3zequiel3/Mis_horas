---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import ProtectedRoute from '../components/ProtectedRoute.astro';

const pageTitle = 'Mi Perfil - Mis Horas';
---

<script>
  import '../styles/perfil.css';
</script>

<BaseLayout title={pageTitle}>
  <ProtectedRoute>
    <Header />
    <div class="container">
    <div class="perfil-container">
      <div class="perfil-card">
        <div class="card-header">
          <h1>Mi Perfil</h1>
          <p>Administra tu informaci√≥n personal</p>
        </div>

        <div class="perfil-content">
          <!-- Informaci√≥n B√°sica -->
          <div class="section">
            <h2>Informaci√≥n Personal</h2>
            <div class="form-group">
              <label>Username</label>
              <input type="text" id="username" readonly />
            </div>

            <div class="form-group">
              <label>Email</label>
              <input type="email" id="email" />
            </div>

            <div class="form-group">
              <label>Nombre Completo</label>
              <input type="text" id="nombre_completo" />
            </div>

            <button id="save-profile-btn" class="btn btn-primary">
              üíæ Guardar Cambios
            </button>
          </div>

          <!-- Seguridad -->
          <div class="section">
            <h2>Seguridad</h2>
            <div class="form-group">
              <label>Contrase√±a Actual</label>
              <input type="password" id="password_actual" />
            </div>

            <div class="form-group">
              <label>Nueva Contrase√±a</label>
              <input type="password" id="password_nueva" />
            </div>

            <button id="change-password-btn" class="btn btn-primary">
              üîê Cambiar Contrase√±a
            </button>
          </div>

          <!-- Configuraci√≥n de Horas -->
          <div class="section">
            <h2>Configuraci√≥n</h2>
            <div class="config-item">
              <label for="usar-horas-reales">
                <input type="checkbox" id="usar-horas-reales" />
                Usar Horas Reales
              </label>
              <p class="help-text">
                Si est√° activado, se usar√°n horas reales en lugar de horas estimadas
              </p>
            </div>

            <button id="toggle-horas-btn" class="btn btn-secondary">
              ‚è±Ô∏è Actualizar Configuraci√≥n
            </button>
          </div>
        </div>

        <div id="success-message" class="alert alert-success" style="display: none;">
          ‚úì Cambios guardados exitosamente
        </div>

        <div id="error-message" class="alert alert-error" style="display: none;">
          ‚úó Error al guardar los cambios
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style></style>

<script>
  import { AuthService } from '../services/auth';
  import { PerfilHandler } from '../handlers/perfil';

  // Verificar autenticaci√≥n
  if (!AuthService.isAuthenticated()) {
    window.location.href = '/login';
  }

  // Guardar perfil
  document.getElementById('save-profile-btn')?.addEventListener('click', async () => {
    await PerfilHandler.guardarPerfil();
  });

  // Cambiar contrase√±a
  document.getElementById('change-password-btn')?.addEventListener('click', async () => {
    await PerfilHandler.cambiarContrase√±a();
  });

  // Actualizar configuraci√≥n
  document.getElementById('toggle-horas-btn')?.addEventListener('click', async () => {
    await PerfilHandler.actualizarConfiguracion();
  });

  // Cargar datos del usuario
  PerfilHandler.loadUserData();
</script>

      </div>
    </div>
  </ProtectedRoute>
</BaseLayout>
